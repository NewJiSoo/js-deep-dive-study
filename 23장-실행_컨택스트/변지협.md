# 23. 실행 컨텍스트
## 23.1 소스코드의 타입
## 23.2 소스코드의 평가와 실행
## 23.3 실행 컨텍스트의 역할
## 23.4 실행 컨텍스트 스택
## 23.5 렉시컬 환경

렉시컬 환경은 식별자와 식별자에 바인딩 된 값, 그리고 상위 스코프에 대한 참조를 기록하는 자료구조로 실행컨텍스트를 구성하는 컴포넌트다.

## 23.6 실행 컨텍스트의 생성과 식별자 검색 과정

전역 객체 생성 -> 전역 코드 평가 -> 전역 코드 실행 -> 함수 코드 평가 -> 함수 코드실행 ... 이런 식으로 순차적으로 생성, 평가, 실행의 단계를 거친다.

### 23.6.1 전역 객체 생성
### 23.6.2 전역 코드 평가

1. 전역 실행 컨텍스트 생성
2. 전역 렉시컬 환경 생성
   - 전역 환경 레코드 생성
       - 객체 환경 레코드 생성
       - 선언적 환경 레코드 생성
   - this 바인딩
   - 외부 렉시컬 환경에 대한 참조 결정
  
1. 전역 실행 컨텍스트 생성

비어있는 전역 실행 컨택스트를 생성하여 실행 컨텍스트 스택에 푸시한다.
이때 실행 컨텍스트는 실행 컨텐스트 스택의 최상위, 즉 실행중인 실행 컨텍스트가 된다.

2. 전역 렉시컬 환경 생성

전역 렉시컬 환경을 생성하고 전역 실행 컨텍스트에 바인딩한다.
렉시컬 환경은 2개의 컴포넌트, 즉 환경레코드와 외부 렉시컬 환경에 대한 참조로 구성된다.

2.1 전역 환경 레코드 생성

전역 렉시컬 환경을 구성하는 컴포넌트인 전역 환경 레코드는 전역 변수를 관리하는 전역 스코프,
전역 객체 빌트인 전역 프로퍼티와 빌트인 전역 함수, 표준 빌트인 객체를 제공한다.

모든 전역 변수가 전역 객체의 프로퍼티가 되는 ES6 이전에는 전역 객체가 전역 환경 레코드의 역할을 수행했다.
하지만 ES6의 let, const 키워드로 선언한 전역 변수는 전역 객체의 프로퍼티가 되지 않고 개념적인 블록 내에 존재하게 된다.

이처럼 기존 var 키워드로 선언한 전역 변수와 ES6의 let, const 키워드로 선언한 전역 변수를 구분하여 관리하기 위해 전역 스코프 역할을 하는 전역 환경 레코드는
객체 환경레코드와 선언적 환경 레코드로 구성되어 있다.

객체 환경 레코드는 기존의 전역 객체가 관리하던 var 키워드로 선언한 전역 변수와 함수 선언문으로 정의한 전역함수,
빌트인 전역 프로퍼티와 빌트인 전역 함수, 표준 빌트인 객체를 관리하고, 선언적 환경 레코드는 let, const 키워드로 선언한 전역 변수를 관리한다.
즉, 전역 환경 레코드의 객체 환경 레코드와 선언적 환경 레코드는 서로 협력하여 전역 스코프와 전역 객체를 관리한다.

2.1.1. 객체 환경 레코드 생성

전역 환경 레코드를 구성하는 컴포넌트인 객체 환경 레코드는 BindingObject라고 부르는 객체와 연결된다.
BindingObject는 전역 객체 생성에서 생성된 전역 객체이다.

전역 코드 평가 과정에서 var 키워드로 선언한 전역 변수와 함수 선언문으로 정의된 전역 함수는 전역 환경 레코드의 객체 환경 레코드에 연결된 BindingObject를 통해
전역 객체의 프로퍼티와 메서드가 된다.
그리고 이 때 등록된 식별자를 전역 환경 레코드의 객체 환경 레코드에서 검색하면 전역 객체의 프로퍼티를 검색하여 반환한다.

이것이 var 키워드로 선언된 전역 변수와 함수 선언문으로 정의된 전역 함수가 전역 객체의 프로퍼티와 매서드가 되고 전역 객체를 가리키는 식별자 없이
전역객체의 프로퍼티를 참조할 수 있는 매커니즘이다.

2.1.2. 선언적 환경 레코드 생성

var 키워드로 선언한 전역 변수와 함수 선언문으로 정의한 전역 함수 이외의 선언, 즉 let, const 키워드로 선언한 전역변수는
선언적 환경 변수 레코드에 등록되고 관리된다.

2.2. this 바인딩

전역 환경 레코드의 `[[GlobalThisValue]]` 내부 슬롯에 this가 바인딩된다.
일반적으로 전역 코드에서 this는 전역 객체를 가리키므로 전역 환경 레코드의 `[[GlobalThisValue]]` 내부 슬롯에는 전역 객체가 바인딩된다.
전역 코드에서 this를 참조하면 전역 환경 레코드의 `[[GlobalThisValue]]` 내부 슬롯에 바인딩 되어 있는 객체가 반환된다.

2.3. 외부 렉시컬 환경에 대한 참조 결정

외부 렉시컬 환경에 대한 참조는 현재 평가 중인 소스코드를 포함하는 외부 소스코드의 렉시컬 환경, 즉 상위 스코프를 가리킨다.
이를 통해 단방향 링크드 리스트인 스코프 체인을 구현한다.

현재 평가 중인 소스코드는 전역 코드다.
전역 코드를 포함하는 소스코드는 없으므로 전역 렉시컬 환경의 외부 렉시컬 환경에 대한 참조에 null이 할당된다.
이는 전역 렉시컬 환경이 스코프 체인의 종점에 존재함을 의미한다.

### 24.6.3 전역 코드 실행
### 24.6.4 foo 함수 코드 평가
### 23.6.5 foo 함수 코드 실행
### 23.6.6 bar 함수 코드 평가
### 23.6.7 bar 함수 코드 실행
### 23.6.8 bar 함수 코드 실행 종료
### 23.6.9 foo 함수 코드 실행 종료
### 23.6.10 전역 코드 실행 종료
## 23.7 실행 컨텍스트와 블록 레벨 스코프
