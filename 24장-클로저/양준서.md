# 24. 클로저

- 클로저는 나해하기로 유명한 자바스크립트의 개념 중 하나이다

> 클로저는 함수와 그 함수가 선언된 렉시컬 환경과의 조합이다.

```
const x = 1

function outerFunc() {
  const x = 10

  function innerFunc() {
    console.log(x) // 10
  }
  innerFunc()
}
outerFunc()
```

outerFunc 함수 내부에 중첩 함수 innerFunc가 정의되고 호출되었다

innerFunc 내부에서 자신을 포함하고 있는 상위 스코프 outerFunc의 x 변수에 접근한다

## 24.1 렉시컬 스코프

> 자바스크립트 엔진은 함수를 어디서 호출했는지가 아니라 함수를 `어디에 정의했는지`에 따라 상위 스코프를 결정하며 이를 렉시컬 스코프라고 한다

```
const x = 1

function foo() {
  const x = 10
  bar()
}

function bar() {
  console.log(x)
}

foo() // ??
bar() // ??
```

foo() 와 bar()의 값은 각각 1이 나온다.

모두 `전역에서 정의된`함수이기 때문에 상위 스코프가 전역이다

## 24.2 함수 객체의 내부 슬롯 [[Environment]]

- 함수가 정의된 환경과 호출되는 환경은 다르기에 정의된 환경에서의 상위 스코프를 기억해야한다. 이 공간을 자신의 내부 슬롯 `[[Environment]]`에 상위 스코프의 참조를 저장한다

- 외부 렉시컬 환경에 대한 참조에는 함수 객체의 내부 슬롯[[Environment]]에 저장된 렉시컬 환경의 참조가 할당된다.

## 24.3 클로저와 렉시컬 환경

```
const x = 1
// 1번
function outer() {
  const x = 10
  const inner = function () { console.log(x) } // 2번
  return inner
}

// outer함수를 호출하면 중첩 함수 inner를 반환한다.
// outer함수의 실행 컨텍스트는 실행 컨텍스트 스택에서 팝되어 제거
const innerFunc = outer() // 3번
innerFunc() // 4번, 10
```

outer함수는 중첩 함수 inner를 반환하고 생명 주기를 마감한다.

이 때 outer 함수의 지역 변수 x와 변수 값 10을 저장하고 있던 outer 함수의 실행 컨텍스트가 제거 되었으므로 outer 함수의 지역 변수 x 또한 생명 주기를 마감한다.

그러나, 4번을 볼 때 결과 값 10이 나온다.

외부 함수보다 중첩 함수가 더 오래 유지되는 경우 중첩 함수는 이미 생명 주기가 종료한 외부 함수의 변수를 참조할 수 있다. 이러한 중첩 함수를 `클로저`라고 부른다.

## 24.4 클로저의 활용

## 24.5 캡슐화와 정보 은닉

## 24.6 자주 발생하는 실수
