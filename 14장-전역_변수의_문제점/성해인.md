# 14. 전역 변수의 문제점
> Q. 전역 변수의 **무분별한** 사용은 위험하다??
> <br>필수가 아니면 전역 변수 대신 지역 변수를 사용해야 하는 이유와 그 방법을 알아보자

<br>

## 14.1 변수의 생명 주기

### 14.1.1 지역 변수의 생명 주기

> 변수에는 생명 주기(life cycle)가 있다: 생명 주기가 없다면 한번 생성된 변수는 프로그램 종료 전까지 계속 메모리 공간을 점유한다.
> 1. 메모리 공간 확보(allocate)
> 2. 메모리 공간 해제(release)
> 3. 가용 메모리 풀(memory pool)에 반환
> ***
> * ***변수는 자신이 등록된 스코프가 소멸(메모리 해제)될 때까지 유효함*** 
> * 전역 변수의 생명 주기 = 애플리케이션의 생명 주기
> * (함수 내부)지역 변수의 생명 주기 = (대체로)해당 함수의 생명 주기(함수가 호출되면 생성, 함수가 종료되면 소멸)
>   * 지역 변수가 함수보다 오래 생존하는 경우도 있는데, 해당 변수 생성&등록 스코프를 다른 곳에서 참조하는 경우

#### 그림 14-1: 지역 변수의 생명 주기




### 예제 14-01
```Javascript
function foo() {
    var x = 'local'; // 지역변수 x 는 foo 함수 호출 전까지는 생성X // 함수 호출X면 함수 내부 변수 선언문도 실행X
    console.log(local); // local
    return x;
}
foo();
console.log(x); // ReferenceError: x is not defined
```
> > 변수 선언은 선언문이 어디에 있든 상관없이 가장 먼저 실행되고, 런타임 이전 단계에서 자바스크립트 엔진에 이해 이루어진다
> 
> 위의 설명은 **전역 변수에 한정**된 것
> <br>함수 내부에서 선언한 변수는 함수 호출 직후, 함수 몸체 코드 한 줄씩 실행되기 이전에 자바스크립트 엔진에 의해 먼저 실행됨


### 예제 14-02: Quiz - (1)에서 출력되는 값은 무엇일까?
```Javascript
var x = 'global';
function foo() {
    console.log(x); // (1)
    var x = 'local';
}
foo();
console.log(x); // global
```

* ***foo함수 내부에서 선언된 지역 변수*** x는
  1. (1) 시점에서 이미 선언, undefined 초기화 상태 → (1)은 값 할당 전 시점이므로 undefined 출력
  2. 변수 할당문으로 값 할당


> 호이스팅은 변수 선언이 스코프의 선두로 끌어올려진 것처럼 동작하는 자바스크립트 고유의 특징을 일컬으며, 스코프 단위로 동작한다.
> * 전역 변수의 호이스팅: 전역 변수의 선언이... → 그러므로 전역 전체에서 유효
> * 지역 변수의 호이스팅: 지역 변수의 선언이...→ 그러므로 (지역)함수 전체에서 유효


### 14.1.2 전역 변수의 생명 주기

함수와 달리, 전역 코드는
1. 명시적인 호출 없이 실행: 코드가 로드되자마자 곧바로 해석되고 실행됨
   * 함수는 실행되는 특별한 진입점이 있음
2. 반환문 사용X, 마지막 문 실행된 다음(더는 실행할 문이 없을 때) 종료
   * 함수는 함수 몸체의 마지막 문 또는 반환문이 실행되면 종료됨

> **var 키워드**로 선언한 전역 변수는 전역 객체의 프로퍼티가 됨
> <br>그 말인즉슨, 전역 변수의 생명 주기 = 전역 객체의 생명 주기


> 전역 객체(global object)
> * 코드가 실행되기 이전, 자바스크립트 엔진에 의해 어떤 객체보다도 먼저 생성되는 특수 객체
>   * 클라이언트 사이드 환경(브라우저): window 객체
>   * 서버 사이드 환경(Node.js): global 객체
> * 환경에 따라 전역 객체를 가리키는 다양한 식별자가 존재하나, ES11에서 **globalThis**로 통일
>   * window, self, this, frames, global 등등이 존재
> * 프로퍼티로 가지는 것: 표준 빌트인 객체, 환경에 따른 호스트 객체, var 키워드로 선언한 전역 변수와 전역 함수
>   * 표준 빌트인 객체: Object, String, Number, Function, Array...
>   * 환경에 따른 호스트 객체: 클라이언트 Web API/Node.js의 호스트 API


## 14.2 전역 변수의 문제점
## 14.3 전역 변수의 사용을 억제하는 방법
### 14.3.1 즉시 실행 함수
### 14.3.2 네임스페이스 객체
### 14.3.3 모듈 패턴
### 14.3.4 ES6 모듈
